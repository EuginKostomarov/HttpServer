# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `normalization_sessions` –≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–π –ë–î
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `normalization_session_id` –≤ —Ç–∞–±–ª–∏—Ü—É `normalized_data` –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö –ë–î
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ `InitServiceSchema` –∏ `InitSchema`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. Backend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ `ServiceDB`:
  - `CreateNormalizationSession(projectDatabaseID int) (int, error)`
  - `UpdateNormalizationSession(sessionID int, status string, finishedAt *time.Time) error`
  - `GetLastNormalizationSession(projectDatabaseID int) (*NormalizationSession, error)`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `handleStartClientNormalization` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `ClientNormalizer` –∏ `Normalizer` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `sessionID`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `InsertNormalizedItemsWithAttributesBatch` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `normalization_session_id`
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π endpoint `/api/clients/{clientId}/projects/{projectId}/normalization/groups` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ `db_id`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `handleFindProjectByDatabase` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ `db_id`

### 3. Frontend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω API route `/api/clients/[clientId]/projects/[projectId]/normalization/groups/route.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `NormalizationResultsTable`:
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –∏ `db_id` –ø–æ –ø—É—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ `database`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π API endpoint —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ API routes –¥–ª—è Next.js 16

### 4. –ö–æ–º–ø–∏–ª—è—Ü–∏—è
- ‚úÖ Backend –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚ö†Ô∏è Frontend –∏–º–µ–µ—Ç –æ—à–∏–±–∫–∏, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π (react-window —Ç–∏–ø—ã)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
```bash
cd E:/HttpServer && go build -o nul ./server
# ‚úÖ –£—Å–ø–µ—à–Ω–æ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
–ú–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–π –ë–î (`InitServiceSchema`)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö –ë–î (`InitSchema`)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è:
```bash
POST /api/clients/{clientId}/projects/{projectId}/normalization/start
{
  "database_path": "path/to/database.db",
  "all_active": false
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
GET /api/clients/{clientId}/projects/{projectId}/normalization/groups?db_id={dbId}&page=1&limit=20
```

–û—Ç–≤–µ—Ç:
```json
{
  "groups": [...],
  "total": 100,
  "page": 1,
  "limit": 20,
  "totalPages": 5
}
```

–ï—Å–ª–∏ –¥–ª—è –±–∞–∑—ã –Ω–µ—Ç —Å–µ—Å—Å–∏–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫.

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ `frontend/app/api/databases/pending/[id]/route.ts` (Promise –¥–ª—è params)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ `frontend/app/api/databases/pending/[id]/[action]/route.ts` (Promise –¥–ª—è params)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FormData.entries()` –≤ `frontend/app/api/clients/[clientId]/projects/[projectId]/databases/route.ts`
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ `frontend/components/pipeline/PipelineOverview.tsx` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `last_updated`)
5. ‚úÖ –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π TODO –≤ `server/server.go` –¥–ª—è `handleGetClientNormalizationGroups`

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `normalization_sessions` —Å `project_database_id`
   - `sessionID` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π –≤ `normalized_data` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `normalization_session_id`

2. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞—Ö–æ–¥–∏—Ç `db_id` –ø–æ –ø—É—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/api/clients/{clientId}/projects/{projectId}/normalization/groups?db_id={dbId}`
   - Backend –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ—Å—Å–∏—é –¥–ª—è `db_id`
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç `normalized_data` –ø–æ `normalization_session_id`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏

3. **–ü—Ä–∏ —Å–º–µ–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `NormalizationResultsTable` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π `db_id` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. Frontend –∏–º–µ–µ—Ç –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:
   - `react-window` —Ç–∏–ø—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
   - –≠—Ç–∏ –æ—à–∏–±–∫–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

2. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–∏–Ω—Ç–µ—Ä–∞ –≤ `normalization/normalizer.go`:
   - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `kpvedCode`, `kpvedName`, `kpvedConfidence` (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

